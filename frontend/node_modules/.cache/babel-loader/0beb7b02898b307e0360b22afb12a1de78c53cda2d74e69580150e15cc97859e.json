{"ast":null,"code":"import{useState,useCallback,useEffect}from\"react\";let logoutTimer;export const useAuth=()=>{const[token,setToken]=useState(false);const[tokenExpirationDate,setTokenExpirationDate]=useState();const[userId,setUserId]=useState(false);const login=useCallback((uid,token,expirationDate)=>{setToken(token);setUserId(uid);const tokenExpirationDate=expirationDate||new Date(new Date().getTime()+1000*60*60);setTokenExpirationDate(tokenExpirationDate);localStorage.setItem(\"userData\",JSON.stringify({userId:uid,token:token,expiration:tokenExpirationDate.toISOString()}));},[]);const logout=useCallback(()=>{setToken(null);setTokenExpirationDate(null);setUserId(null);localStorage.removeItem(\"userData\");},[]);useEffect(()=>{if(token&&tokenExpirationDate){const remainingTime=tokenExpirationDate.getTime()-new Date().getTime();logoutTimer=setTimeout(logout,remainingTime);}else{clearTimeout(logoutTimer);}},[token,logout,tokenExpirationDate]);useEffect(()=>{const storedData=JSON.parse(localStorage.getItem(\"userData\"));if(storedData&&storedData.token&&new Date(storedData.expiration)>new Date()){login(storedData.userId,storedData.token);}},[login]);return{token,login,logout,userId};};","map":{"version":3,"names":["useState","useCallback","useEffect","logoutTimer","useAuth","token","setToken","tokenExpirationDate","setTokenExpirationDate","userId","setUserId","login","uid","expirationDate","Date","getTime","localStorage","setItem","JSON","stringify","expiration","toISOString","logout","removeItem","remainingTime","setTimeout","clearTimeout","storedData","parse","getItem"],"sources":["C:/Users/quang/Desktop/Udemy_MERN/frontend/src/shared/hooks/auth-hook.js"],"sourcesContent":["import { useState, useCallback, useEffect } from \"react\";\r\n\r\nlet logoutTimer;\r\n\r\nexport const useAuth = () => {\r\n  const [token, setToken] = useState(false);\r\n  const [tokenExpirationDate, setTokenExpirationDate] = useState();\r\n  const [userId, setUserId] = useState(false);\r\n\r\n  const login = useCallback((uid, token, expirationDate) => {\r\n    setToken(token);\r\n    setUserId(uid);\r\n    const tokenExpirationDate =\r\n      expirationDate || new Date(new Date().getTime() + 1000 * 60 * 60);\r\n    setTokenExpirationDate(tokenExpirationDate);\r\n    localStorage.setItem(\r\n      \"userData\",\r\n      JSON.stringify({\r\n        userId: uid,\r\n        token: token,\r\n        expiration: tokenExpirationDate.toISOString(),\r\n      })\r\n    );\r\n  }, []);\r\n\r\n  const logout = useCallback(() => {\r\n    setToken(null);\r\n    setTokenExpirationDate(null);\r\n    setUserId(null);\r\n    localStorage.removeItem(\"userData\");\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (token && tokenExpirationDate) {\r\n      const remainingTime =\r\n        tokenExpirationDate.getTime() - new Date().getTime();\r\n      logoutTimer = setTimeout(logout, remainingTime);\r\n    } else {\r\n      clearTimeout(logoutTimer);\r\n    }\r\n  }, [token, logout, tokenExpirationDate]);\r\n\r\n  useEffect(() => {\r\n    const storedData = JSON.parse(localStorage.getItem(\"userData\"));\r\n    if (\r\n      storedData &&\r\n      storedData.token &&\r\n      new Date(storedData.expiration) > new Date()\r\n    ) {\r\n      login(storedData.userId, storedData.token);\r\n    }\r\n  }, [login]);\r\n\r\n  return {token, login, logout, userId};\r\n};\r\n"],"mappings":"AAAA,OAASA,QAAQ,CAAEC,WAAW,CAAEC,SAAS,KAAQ,OAAO,CAExD,GAAI,CAAAC,WAAW,CAEf,MAAO,MAAM,CAAAC,OAAO,CAAGA,CAAA,GAAM,CAC3B,KAAM,CAACC,KAAK,CAAEC,QAAQ,CAAC,CAAGN,QAAQ,CAAC,KAAK,CAAC,CACzC,KAAM,CAACO,mBAAmB,CAAEC,sBAAsB,CAAC,CAAGR,QAAQ,CAAC,CAAC,CAChE,KAAM,CAACS,MAAM,CAAEC,SAAS,CAAC,CAAGV,QAAQ,CAAC,KAAK,CAAC,CAE3C,KAAM,CAAAW,KAAK,CAAGV,WAAW,CAAC,CAACW,GAAG,CAAEP,KAAK,CAAEQ,cAAc,GAAK,CACxDP,QAAQ,CAACD,KAAK,CAAC,CACfK,SAAS,CAACE,GAAG,CAAC,CACd,KAAM,CAAAL,mBAAmB,CACvBM,cAAc,EAAI,GAAI,CAAAC,IAAI,CAAC,GAAI,CAAAA,IAAI,CAAC,CAAC,CAACC,OAAO,CAAC,CAAC,CAAG,IAAI,CAAG,EAAE,CAAG,EAAE,CAAC,CACnEP,sBAAsB,CAACD,mBAAmB,CAAC,CAC3CS,YAAY,CAACC,OAAO,CAClB,UAAU,CACVC,IAAI,CAACC,SAAS,CAAC,CACbV,MAAM,CAAEG,GAAG,CACXP,KAAK,CAAEA,KAAK,CACZe,UAAU,CAAEb,mBAAmB,CAACc,WAAW,CAAC,CAC9C,CAAC,CACH,CAAC,CACH,CAAC,CAAE,EAAE,CAAC,CAEN,KAAM,CAAAC,MAAM,CAAGrB,WAAW,CAAC,IAAM,CAC/BK,QAAQ,CAAC,IAAI,CAAC,CACdE,sBAAsB,CAAC,IAAI,CAAC,CAC5BE,SAAS,CAAC,IAAI,CAAC,CACfM,YAAY,CAACO,UAAU,CAAC,UAAU,CAAC,CACrC,CAAC,CAAE,EAAE,CAAC,CAENrB,SAAS,CAAC,IAAM,CACd,GAAIG,KAAK,EAAIE,mBAAmB,CAAE,CAChC,KAAM,CAAAiB,aAAa,CACjBjB,mBAAmB,CAACQ,OAAO,CAAC,CAAC,CAAG,GAAI,CAAAD,IAAI,CAAC,CAAC,CAACC,OAAO,CAAC,CAAC,CACtDZ,WAAW,CAAGsB,UAAU,CAACH,MAAM,CAAEE,aAAa,CAAC,CACjD,CAAC,IAAM,CACLE,YAAY,CAACvB,WAAW,CAAC,CAC3B,CACF,CAAC,CAAE,CAACE,KAAK,CAAEiB,MAAM,CAAEf,mBAAmB,CAAC,CAAC,CAExCL,SAAS,CAAC,IAAM,CACd,KAAM,CAAAyB,UAAU,CAAGT,IAAI,CAACU,KAAK,CAACZ,YAAY,CAACa,OAAO,CAAC,UAAU,CAAC,CAAC,CAC/D,GACEF,UAAU,EACVA,UAAU,CAACtB,KAAK,EAChB,GAAI,CAAAS,IAAI,CAACa,UAAU,CAACP,UAAU,CAAC,CAAG,GAAI,CAAAN,IAAI,CAAC,CAAC,CAC5C,CACAH,KAAK,CAACgB,UAAU,CAAClB,MAAM,CAAEkB,UAAU,CAACtB,KAAK,CAAC,CAC5C,CACF,CAAC,CAAE,CAACM,KAAK,CAAC,CAAC,CAEX,MAAO,CAACN,KAAK,CAAEM,KAAK,CAAEW,MAAM,CAAEb,MAAM,CAAC,CACvC,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}